CREATE SERVER osm 
FOREIGN DATA WRAPPER nominatim_fdw 
OPTIONS (url 'https://nominatim.openstreetmap.org');
SELECT * FROM nominatim_fdw_version();
                                                                                 nominatim_fdw_version                                                                                 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nominatim_fdw = 1.0.0-dev, libxml/2.9.10 libcurl/7.74.0 OpenSSL/1.1.1w zlib/1.2.11 brotli/1.0.9 libidn2/2.3.0 libpsl/0.21.0 (+libidn2/2.3.0) libssh2/1.9.0 nghttp2/1.43.0 librtmp/2.3
(1 row)

SELECT 
    osm_id, osm_type, 
	ref, 
	class, 
	display_name, 
	display_rank, 
	place_id IS NOT NULL AND place_id > 0 AS valid_place_id, 
	place_rank,
    lon, lat, boundingbox, 
	importance, 
	icon, 
	timestamp IS NOT NULL AS valid_timestamp, 
	attribution,
    querystring, 
	length(polygon) AS polygon_length, 
	exclude_place_ids IS NOT NULL AS valid_exclude_place_ids, 
	more_url IS NOT NULL AND more_url <> '' AS valid_more_url,
    jsonb_pretty(extratags) AS extratags, 
	jsonb_pretty(namedetails) AS namedetails,
    jsonb_pretty(addressdetails) AS addressdetails
FROM nominatim_search(
      server_name => 'osm',
      q => 'einsteinstraße 60, münster, germany',
      extratags => true,
      addressdetails => true,
      namedetails => true,
      polygon => 'polygon_text',
      email => 'jim.jones@uni-muenster.de',
      countrycodes => 'DE,BR,US',
      featuretype => 'poi',
      dedupe => true,
      exclude_place_ids => '42,73',
      viewbox => '51.9659397,51.9661584,7.6036345,7.6039893',
      polygon_threshold => 0.1,
      layer => 'address',
      limit_result => 1,
      bounded => false,
      accept_language => 'de_DE,de,q=0.9');
  osm_id  | osm_type |  ref   | class  |                                                    display_name                                                     | display_rank | valid_place_id | place_rank |    lon    |    lat     |                boundingbox                |      importance      | icon | valid_timestamp |                              attribution                              |             querystring             | polygon_length | valid_exclude_place_ids | valid_more_url |                     extratags                     |                      namedetails                       |            addressdetails             
----------+----------+--------+--------+---------------------------------------------------------------------------------------------------------------------+--------------+----------------+------------+-----------+------------+-------------------------------------------+----------------------+------+-----------------+-----------------------------------------------------------------------+-------------------------------------+----------------+-------------------------+----------------+---------------------------------------------------+--------------------------------------------------------+---------------------------------------
 88291927 | way      | WWU IT | office | WWU IT, 60, Einsteinstraße, Neutor, Innenstadtring, Münster-Mitte, Münster, Nordrhein-Westfalen, 48149, Deutschland |              | t              |         30 | 7.6038115 | 51.9660873 | 51.9659397,51.9661584,7.6036345,7.6039893 | 9.99999999995449e-06 |      | t               | Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright | einsteinstraße 60, münster, germany |            115 | t                       | t              | {                                                +| {                                                     +| {                                    +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "website": "https://www.uni-muenster.de/IT/",+|     "name": "WWU IT",                                 +|     "city": "Münster",               +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "building": "university",                    +|     "name:de": "WWU IT",                              +|     "road": "Einsteinstraße",        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "roof:shape": "flat",                        +|     "old_name": "Zentrum für Informationsverarbeitung"+|     "state": "Nordrhein-Westfalen",  +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "wheelchair": "yes",                         +| }                                                      |     "office": "WWU IT",              +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "roof:colour": "#A9A9A9",                    +|                                                        |     "suburb": "Innenstadtring",      +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "old_short_name": "ZIV",                     +|                                                        |     "country": "Deutschland",        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "building:colour": "#D3D3D3",                +|                                                        |     "postcode": "48149",             +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |     "building:levels": "2"                       +|                                                        |     "country_code": "de",            +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                | }                                                 |                                                        |     "house_number": "60",            +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |                                                   |                                                        |     "city_district": "Münster-Mitte",+
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |                                                   |                                                        |     "neighbourhood": "Neutor",       +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |                                                   |                                                        |     "ISO3166-2-lvl4": "DE-NW"        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                     |                |                         |                |                                                   |                                                        | }
(1 row)

SELECT pg_sleep(2);
 pg_sleep 
----------
 
(1 row)

SELECT 
    osm_id, osm_type, 
	ref, 
	class, 
	display_name, 
	display_rank, 
	place_id IS NOT NULL AND place_id > 0 AS valid_place_id, 
	place_rank,
    lon, lat, boundingbox, 
	importance, 
	icon, 
	timestamp IS NOT NULL AS valid_timestamp, 
	attribution,
    querystring, 
	length(polygon) AS polygon_length, 
	exclude_place_ids IS NOT NULL AS valid_exclude_place_ids, 
	more_url IS NOT NULL AND more_url <> '' AS valid_more_url,
    jsonb_pretty(extratags) AS extratags, 
	jsonb_pretty(namedetails) AS namedetails,
    jsonb_pretty(addressdetails) AS addressdetails
FROM nominatim_search(
      server_name => 'osm',
      amenity => 'wwu it',
      polygon => 'polygon_text',
      extratags => true,
      addressdetails => true,
      namedetails => true,      
      street => 'einsteinstraße 60',
      city => 'münster',
      state => 'nordrhein westfalen',
      country => 'germany',
      postalcode => '48149',
      email => 'jim.jones@uni-muenster.de',
      countrycodes => 'DE,BR,US',
      featuretype => 'office',
      dedupe => true,
      exclude_place_ids => '42, 73',
      viewbox => '51.9659397,51.9661584,7.6036345,7.6039893',
      polygon_threshold => 0.1,
      layer => 'address',
      limit_result => 1,
      accept_language => 'de_DE,de,q=0.9');
  osm_id  | osm_type |  ref   | class  |                                                    display_name                                                     | display_rank | valid_place_id | place_rank |    lon    |    lat     |                boundingbox                |      importance      | icon | valid_timestamp |                              attribution                              |                               querystring                               | polygon_length | valid_exclude_place_ids | valid_more_url |                     extratags                     |                      namedetails                       |            addressdetails             
----------+----------+--------+--------+---------------------------------------------------------------------------------------------------------------------+--------------+----------------+------------+-----------+------------+-------------------------------------------+----------------------+------+-----------------+-----------------------------------------------------------------------+-------------------------------------------------------------------------+----------------+-------------------------+----------------+---------------------------------------------------+--------------------------------------------------------+---------------------------------------
 88291927 | way      | WWU IT | office | WWU IT, 60, Einsteinstraße, Neutor, Innenstadtring, Münster-Mitte, Münster, Nordrhein-Westfalen, 48149, Deutschland |              | t              |         30 | 7.6038115 | 51.9660873 | 51.9659397,51.9661584,7.6036345,7.6039893 | 9.99999999995449e-06 |      | t               | Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright | wwu it, einsteinstraße 60, münster, nordrhein westfalen, 48149, germany |            115 | t                       | t              | {                                                +| {                                                     +| {                                    +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "website": "https://www.uni-muenster.de/IT/",+|     "name": "WWU IT",                                 +|     "city": "Münster",               +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "building": "university",                    +|     "name:de": "WWU IT",                              +|     "road": "Einsteinstraße",        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "roof:shape": "flat",                        +|     "old_name": "Zentrum für Informationsverarbeitung"+|     "state": "Nordrhein-Westfalen",  +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "wheelchair": "yes",                         +| }                                                      |     "office": "WWU IT",              +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "roof:colour": "#A9A9A9",                    +|                                                        |     "suburb": "Innenstadtring",      +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "old_short_name": "ZIV",                     +|                                                        |     "country": "Deutschland",        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "building:colour": "#D3D3D3",                +|                                                        |     "postcode": "48149",             +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |     "building:levels": "2"                       +|                                                        |     "country_code": "de",            +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                | }                                                 |                                                        |     "house_number": "60",            +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |                                                   |                                                        |     "city_district": "Münster-Mitte",+
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |                                                   |                                                        |     "neighbourhood": "Neutor",       +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |                                                   |                                                        |     "ISO3166-2-lvl4": "DE-NW"        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |                                                                         |                |                         |                |                                                   |                                                        | }
(1 row)

SELECT pg_sleep(2);
 pg_sleep 
----------
 
(1 row)

SELECT 
    osm_id, 
	osm_type, 
	result, 
	ref, 
	place_id IS NOT NULL AND place_id > 0 AS valid_place_id, 
	place_rank, 
	lon, lat, boundingbox, 
    icon, 
	timestamp IS NOT NULL AS valid_timestamp, 
	attribution, 
	querystring, 
    length(polygon) AS polygon_length, 
	jsonb_pretty(extratags) AS extratags, 
    jsonb_pretty(namedetails) AS namedetails, 
	jsonb_pretty(addressparts) AS addressparts
FROM nominatim_reverse(
        server_name => 'osm', 
        lon => 7.6038115,
        lat => 51.9660873,        
        polygon => 'polygon_text',
        extratags => true,
        addressdetails => true,
        namedetails => true,
        accept_language => 'de_DE,de,q=0.9');
  osm_id  | osm_type |                                                       result                                                        |  ref   | valid_place_id | place_rank |    lon    |    lat     |                boundingbox                | icon | valid_timestamp |                              attribution                              |              querystring              | polygon_length |                     extratags                     |                      namedetails                       |             addressparts              
----------+----------+---------------------------------------------------------------------------------------------------------------------+--------+----------------+------------+-----------+------------+-------------------------------------------+------+-----------------+-----------------------------------------------------------------------+---------------------------------------+----------------+---------------------------------------------------+--------------------------------------------------------+---------------------------------------
 88291927 | way      | WWU IT, 60, Einsteinstraße, Neutor, Innenstadtring, Münster-Mitte, Münster, Nordrhein-Westfalen, 48149, Deutschland | WWU IT | t              |         30 | 7.6038115 | 51.9660873 | 51.9659397,51.9661584,7.6036345,7.6039893 |      | t               | Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright | lat=51.966087&lon=7.603811&format=xml |            300 | {                                                +| {                                                     +| {                                    +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "website": "https://www.uni-muenster.de/IT/",+|     "name": "WWU IT",                                 +|     "city": "Münster",               +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "building": "university",                    +|     "name:de": "WWU IT",                              +|     "road": "Einsteinstraße",        +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "roof:shape": "flat",                        +|     "old_name": "Zentrum für Informationsverarbeitung"+|     "state": "Nordrhein-Westfalen",  +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "wheelchair": "yes",                         +| }                                                      |     "office": "WWU IT",              +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "roof:colour": "#A9A9A9",                    +|                                                        |     "suburb": "Innenstadtring",      +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "old_short_name": "ZIV",                     +|                                                        |     "country": "Deutschland",        +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "building:colour": "#D3D3D3",                +|                                                        |     "postcode": "48149",             +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |     "building:levels": "2"                       +|                                                        |     "country_code": "de",            +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                | }                                                 |                                                        |     "house_number": "60",            +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |                                                   |                                                        |     "city_district": "Münster-Mitte",+
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |                                                   |                                                        |     "neighbourhood": "Neutor",       +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |                                                   |                                                        |     "ISO3166-2-lvl4": "DE-NW"        +
          |          |                                                                                                                     |        |                |            |           |            |                                           |      |                 |                                                                       |                                       |                |                                                   |                                                        | }
(1 row)

SELECT pg_sleep(2);
 pg_sleep 
----------
 
(1 row)

		
SELECT 
    osm_id, osm_type, 
	ref, 
	class, 
	display_name, 
	display_rank, 
	place_id IS NOT NULL AND place_id > 0 AS valid_place_id, 
	place_rank,
    lon, lat, boundingbox, 
	importance, 
	icon, 
	timestamp IS NOT NULL AS valid_timestamp, 
	attribution,
    querystring, 
	length(polygon) AS polygon_length, 
    jsonb_pretty(extratags) AS extratags, 
	jsonb_pretty(namedetails) AS namedetails,
    jsonb_pretty(addressdetails) AS addressdetails
FROM nominatim_lookup(
      server_name => 'osm',
      osm_ids => 'W88291927',
      extratags => true,
      addressdetails => true,
      namedetails => true,
      polygon => 'polygon_text',
      email => 'jim.jones@uni-muenster.de',
      countrycodes => 'DE,BR,US',
      featuretype => 'office',
      dedupe => true,
      exclude_place_ids => '42,73',
      viewbox => '51.9659397,51.9661584,7.6036345,7.6039893',
      polygon_threshold => 0.1,
      layer => 'address',
      accept_language => 'de_DE,de,q=0.9');		
  osm_id  | osm_type |  ref   | class  |                                                    display_name                                                     | display_rank | valid_place_id | place_rank |    lon    |    lat     |                boundingbox                |      importance      | icon | valid_timestamp |                              attribution                              | querystring | polygon_length |                     extratags                     |                      namedetails                       |            addressdetails             
----------+----------+--------+--------+---------------------------------------------------------------------------------------------------------------------+--------------+----------------+------------+-----------+------------+-------------------------------------------+----------------------+------+-----------------+-----------------------------------------------------------------------+-------------+----------------+---------------------------------------------------+--------------------------------------------------------+---------------------------------------
 88291927 | way      | WWU IT | office | WWU IT, 60, Einsteinstraße, Neutor, Innenstadtring, Münster-Mitte, Münster, Nordrhein-Westfalen, 48149, Deutschland |              | t              |         30 | 7.6038115 | 51.9660873 | 51.9659397,51.9661584,7.6036345,7.6039893 | 9.99999999995449e-06 |      | t               | Data © OpenStreetMap contributors, ODbL 1.0. http://osm.org/copyright |             |            115 | {                                                +| {                                                     +| {                                    +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "website": "https://www.uni-muenster.de/IT/",+|     "name": "WWU IT",                                 +|     "city": "Münster",               +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "building": "university",                    +|     "name:de": "WWU IT",                              +|     "road": "Einsteinstraße",        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "roof:shape": "flat",                        +|     "old_name": "Zentrum für Informationsverarbeitung"+|     "state": "Nordrhein-Westfalen",  +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "wheelchair": "yes",                         +| }                                                      |     "office": "WWU IT",              +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "roof:colour": "#A9A9A9",                    +|                                                        |     "suburb": "Innenstadtring",      +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "old_short_name": "ZIV",                     +|                                                        |     "country": "Deutschland",        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "building:colour": "#D3D3D3",                +|                                                        |     "postcode": "48149",             +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |     "building:levels": "2"                       +|                                                        |     "country_code": "de",            +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                | }                                                 |                                                        |     "house_number": "60",            +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |                                                   |                                                        |     "city_district": "Münster-Mitte",+
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |                                                   |                                                        |     "neighbourhood": "Neutor",       +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |                                                   |                                                        |     "ISO3166-2-lvl4": "DE-NW"        +
          |          |        |        |                                                                                                                     |              |                |            |           |            |                                           |                      |      |                 |                                                                       |             |                |                                                   |                                                        | }
(1 row)

